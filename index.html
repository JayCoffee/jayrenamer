<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ファイルリネーム管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #b8f3d8 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #3d9970;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3d9970;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }

        .btn {
            background: linear-gradient(135deg, #4a90e2 0%, #5da3f5 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #4a90e2;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .rules-list {
            list-style: none;
        }

        .rule-item {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }

        .rule-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 6px;
            color: #333;
        }

        .rule-pattern {
            font-family: 'Courier New', monospace;
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .rule-description {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .rule-actions {
            display: flex;
            gap: 8px;
        }

        .rule-actions button {
            flex: 1;
            padding: 8px;
            font-size: 12px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 12px;
            background: #f5f5f5;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-input-label:hover {
            background: #ebebeb;
        }

        .file-list {
            margin-top: 16px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .file-original {
            color: #999;
            text-decoration: line-through;
        }

        .file-new {
            color: #667eea;
            font-weight: 600;
        }

        .preview-area {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            min-height: 100px;
        }

        .helper-text {
            font-size: 0.85rem;
            color: #888;
            margin-top: 6px;
        }

        .variables-help {
            background: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.85rem;
            color: #856404;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>📁 ファイルリネーム管理</h1>
            <p class="subtitle">命名規則を保存して、ファイルを簡単にリネーム</p>
        </header>

        <div class="grid">
            <!-- 左側: ルール作成 -->
            <div class="card">
                <h2 class="card-title">新規ルール作成</h2>
                <div class="form-group">
                    <label for="ruleName">ルール名</label>
                    <input type="text" id="ruleName" placeholder="例: プロジェクトファイル">
                </div>
                <div class="form-group">
                    <label for="rulePattern">パターン</label>
                    <textarea id="rulePattern" placeholder="例: {project}_{date}_{counter}"></textarea>
                    <div class="helper-text">利用可能な変数: {date}, {time}, {counter}, {project}, {category}, {ext}</div>
                </div>
                <div class="form-group">
                    <label for="ruleDescription">説明（オプション）</label>
                    <input type="text" id="ruleDescription" placeholder="このルールの用途を説明">
                </div>
                <button class="btn" onclick="addRule()">ルールを保存</button>

                <div class="variables-help">
                    <strong>変数の例:</strong><br>
                    {date} → 2025-10-20<br>
                    {time} → 14-30-45<br>
                    {counter} → 001, 002, 003...<br>
                    {project}, {category} → 手動入力<br>
                    {ext} → 元のファイル拡張子
                </div>
            </div>

            <!-- 右側: 保存済みルール -->
            <div class="card">
                <h2 class="card-title">保存済みルール</h2>
                <ul id="rulesList" class="rules-list"></ul>
                <div id="emptyState" class="empty-state">
                    まだルールがありません<br>左側からルールを作成してください
                </div>
            </div>
        </div>

        <!-- ファイルリネーム -->
        <div class="card">
            <h2 class="card-title">ファイルをリネーム</h2>
            <div class="form-group">
                <label for="selectRule">使用するルールを選択</label>
                <select id="selectRule" onchange="updatePreview()">
                    <option value="">-- ルールを選択 --</option>
                </select>
            </div>

            <div class="form-group">
                <label>プロジェクト名</label>
                <input type="text" id="projectName" placeholder="例: MyProject" onkeyup="updatePreview()">
            </div>

            <div class="form-group">
                <label>カテゴリー</label>
                <input type="text" id="categoryName" placeholder="例: Document" onkeyup="updatePreview()">
            </div>

            <div class="form-group">
                <label>ファイルを選択</label>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" multiple onchange="handleFiles()">
                    <label for="fileInput" class="file-input-label">
                        📎 クリックしてファイルを選択（複数可）
                    </label>
                </div>
            </div>

            <div class="preview-area" id="previewArea">
                <strong>プレビュー:</strong>
                <div id="filePreview" class="file-list"></div>
            </div>

            <button class="btn" onclick="downloadRenamedFiles()">リネームしてダウンロード</button>
        </div>
    </div>

    <script>
        let rules = [];
        let selectedFiles = [];

        // ルールを追加
        function addRule() {
            const name = document.getElementById('ruleName').value.trim();
            const pattern = document.getElementById('rulePattern').value.trim();
            const description = document.getElementById('ruleDescription').value.trim();

            if (!name || !pattern) {
                alert('ルール名とパターンを入力してください');
                return;
            }

            const rule = {
                id: Date.now(),
                name,
                pattern,
                description
            };

            rules.push(rule);
            saveRules();
            renderRules();
            
            // フォームをクリア
            document.getElementById('ruleName').value = '';
            document.getElementById('rulePattern').value = '';
            document.getElementById('ruleDescription').value = '';
        }

        // ルールを描画
        function renderRules() {
            const list = document.getElementById('rulesList');
            const emptyState = document.getElementById('emptyState');
            const select = document.getElementById('selectRule');

            if (rules.length === 0) {
                list.innerHTML = '';
                emptyState.style.display = 'block';
                select.innerHTML = '<option value="">-- ルールを選択 --</option>';
                return;
            }

            emptyState.style.display = 'none';
            
            list.innerHTML = rules.map(rule => `
                <li class="rule-item">
                    <div class="rule-name">${rule.name}</div>
                    <div class="rule-pattern">${rule.pattern}</div>
                    ${rule.description ? `<div class="rule-description">${rule.description}</div>` : ''}
                    <div class="rule-actions">
                        <button class="btn btn-secondary" onclick="useRule(${rule.id})">使用</button>
                        <button class="btn btn-danger" onclick="deleteRule(${rule.id})">削除</button>
                    </div>
                </li>
            `).join('');

            select.innerHTML = '<option value="">-- ルールを選択 --</option>' + 
                rules.map(rule => `<option value="${rule.id}">${rule.name}</option>`).join('');
        }

        // ルールを使用
        function useRule(id) {
            document.getElementById('selectRule').value = id;
            updatePreview();
        }

        // ルールを削除
        function deleteRule(id) {
            if (confirm('このルールを削除しますか?')) {
                rules = rules.filter(r => r.id !== id);
                saveRules();
                renderRules();
                updatePreview();
            }
        }

        // ファイル選択
        function handleFiles() {
            selectedFiles = Array.from(document.getElementById('fileInput').files);
            updatePreview();
        }

        // プレビュー更新
        function updatePreview() {
            const ruleId = parseInt(document.getElementById('selectRule').value);
            const preview = document.getElementById('filePreview');

            if (!ruleId || selectedFiles.length === 0) {
                preview.innerHTML = '<div style="color: #999;">ルールとファイルを選択してください</div>';
                return;
            }

            const rule = rules.find(r => r.id === ruleId);
            if (!rule) return;

            const project = document.getElementById('projectName').value;
            const category = document.getElementById('categoryName').value;

            preview.innerHTML = selectedFiles.map((file, index) => {
                const newName = applyPattern(rule.pattern, file.name, index + 1, project, category);
                return `
                    <div class="file-item">
                        <span class="file-original">${file.name}</span>
                        <span>→</span>
                        <span class="file-new">${newName}</span>
                    </div>
                `;
            }).join('');
        }

        // パターンを適用
        function applyPattern(pattern, originalName, counter, project, category) {
            const ext = originalName.substring(originalName.lastIndexOf('.'));
            const date = new Date();
            
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return pattern
                .replace(/{date}/g, `${year}-${month}-${day}`)
                .replace(/{time}/g, `${hours}-${minutes}-${seconds}`)
                .replace(/{counter}/g, String(counter).padStart(3, '0'))
                .replace(/{project}/g, project || 'project')
                .replace(/{category}/g, category || 'category')
                .replace(/{ext}/g, ext);
        }

        // リネームしてダウンロード
        function downloadRenamedFiles() {
            const ruleId = parseInt(document.getElementById('selectRule').value);
            if (!ruleId || selectedFiles.length === 0) {
                alert('ルールとファイルを選択してください');
                return;
            }

            const rule = rules.find(r => r.id === ruleId);
            const project = document.getElementById('projectName').value;
            const category = document.getElementById('categoryName').value;

            selectedFiles.forEach((file, index) => {
                const newName = applyPattern(rule.pattern, file.name, index + 1, project, category);
                const url = URL.createObjectURL(file);
                const a = document.createElement('a');
                a.href = url;
                a.download = newName;
                a.click();
                URL.revokeObjectURL(url);
            });

            alert('ファイルのダウンロードを開始しました');
        }

        // ルールを保存
        function saveRules() {
            const rulesData = JSON.stringify(rules);
            // メモリに保存（ページリロードで消える）
            window.savedRules = rulesData;
        }

        // ルールを読み込み
        function loadRules() {
            if (window.savedRules) {
                rules = JSON.parse(window.savedRules);
                renderRules();
            }
        }

        // 初期化
        loadRules();
        renderRules();
    </script>
</body>
</html>
